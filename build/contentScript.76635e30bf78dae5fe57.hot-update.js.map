{"version":3,"file":"contentScript.76635e30bf78dae5fe57.hot-update.js","mappings":";;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;ACpHA","sources":["webpack://phabricator-extension/./src/pages/Content/index.ts","webpack://phabricator-extension/webpack/runtime/getFullHash"],"sourcesContent":["import { fetchGetFileReviewers, getIsAuthor } from './modules/diff';\nconsole.log('Content script works!');\n// const diffId = window.location.pathname.slice(1);\nwindow.isAuthor = getIsAuthor();\nwindow.activeGroups = new Set();\nvar addOverlay = function (fileReviewersMapping, reviewerFilesMapping, fileMapping) {\n    var wrapper = document.createElement('div');\n    wrapper.classList.add('Overlay');\n    var tocBtn = document.createElement('button');\n    tocBtn.innerHTML = 'Navigate to files list';\n    tocBtn.addEventListener('click', function () {\n        window.location.href = '#toc';\n    });\n    var checkboxWrapperEl = document.createElement('div');\n    checkboxWrapperEl.classList.add('Checkbox-wrapper');\n    Object.entries(reviewerFilesMapping).forEach(function (_a) {\n        var name = _a[0], files = _a[1];\n        var checkbox = document.createElement('div');\n        checkbox.classList.add('Checkbox');\n        var input = document.createElement('input');\n        input.setAttribute('type', 'checkbox');\n        input.setAttribute('name', 'group[]');\n        input.setAttribute('value', name);\n        input.setAttribute('id', name);\n        input.addEventListener('change', function (event) {\n            var _a;\n            if ((_a = event.target) === null || _a === void 0 ? void 0 : _a.checked) {\n                window.activeGroups.add(name);\n            }\n            else {\n                window.activeGroups.delete(name);\n            }\n            document.querySelectorAll('.differential-file-icon-header').forEach(function (headerEl) {\n                var _a, _b, _c, _d, _e, _f;\n                var filePath = (_a = headerEl.childNodes[1].textContent) !== null && _a !== void 0 ? _a : '';\n                var viewOptionsEl = (_b = headerEl.parentElement) === null || _b === void 0 ? void 0 : _b.querySelector('[data-sigil=\"differential-view-options\"]');\n                viewOptionsEl === null || viewOptionsEl === void 0 ? void 0 : viewOptionsEl.dispatchEvent(new Event('click'));\n                var shouldExpand = window.activeGroups.size === 0 || ((_d = Array.from((_c = fileReviewersMapping[filePath]) !== null && _c !== void 0 ? _c : [])) === null || _d === void 0 ? void 0 : _d.some(function (reviewer) { return window.activeGroups.has(reviewer); }));\n                var actionEl = document.querySelector(shouldExpand ? '.fa-expand' : '.fa-compress');\n                if (actionEl) {\n                    (_f = (_e = actionEl.parentElement) === null || _e === void 0 ? void 0 : _e.querySelector('a')) === null || _f === void 0 ? void 0 : _f.dispatchEvent(new Event('click'));\n                }\n                else {\n                    viewOptionsEl === null || viewOptionsEl === void 0 ? void 0 : viewOptionsEl.dispatchEvent(new Event('click'));\n                }\n            });\n            document.body.click();\n        });\n        var label = document.createElement('label');\n        label.setAttribute('for', name);\n        label.innerHTML = name;\n        var actionBtns = document.createElement('div');\n        actionBtns.classList.add('NavigationBtns-wrapper');\n        var loadBtn = document.createElement('button');\n        loadBtn.classList.add('small');\n        loadBtn.innerHTML = 'Load';\n        loadBtn.addEventListener('click', function () {\n            files === null || files === void 0 ? void 0 : files.forEach(function (filePath) {\n                var _a;\n                (_a = document.querySelector(\"a[href=\\\"#diff-\".concat(fileMapping[filePath].link.slice(1), \"\\\"]\"))) === null || _a === void 0 ? void 0 : _a.dispatchEvent(new Event('click'));\n            });\n        });\n        var backBtn = document.createElement('button');\n        backBtn.classList.add('small');\n        backBtn.innerHTML = 'Back';\n        backBtn.setAttribute('data-id', '0');\n        backBtn.addEventListener('click', function () {\n            var _a;\n            var index = (_a = backBtn.getAttribute('data-id')) !== null && _a !== void 0 ? _a : '';\n            var link = fileMapping[Array.from(reviewerFilesMapping[name])[+index]].link;\n            window.location.href = link;\n            backBtn.setAttribute('data-id', \"\".concat((+index + 1) % reviewerFilesMapping[name].size));\n        });\n        var nextBtn = document.createElement('button');\n        nextBtn.classList.add('small');\n        nextBtn.innerHTML = 'Next';\n        nextBtn.setAttribute('data-id', \"\".concat(reviewerFilesMapping[name].size - 1));\n        nextBtn.addEventListener('click', function () {\n            var _a;\n            var index = (_a = nextBtn.getAttribute('data-id')) !== null && _a !== void 0 ? _a : '';\n            var link = fileMapping[Array.from(reviewerFilesMapping[name])[+index]].link;\n            window.location.href = link;\n            nextBtn.setAttribute('data-id', \"\".concat((reviewerFilesMapping[name].size + +index - 1) % reviewerFilesMapping[name].size));\n        });\n        actionBtns.appendChild(loadBtn);\n        actionBtns.appendChild(backBtn);\n        actionBtns.appendChild(nextBtn);\n        label.appendChild(actionBtns);\n        checkbox.appendChild(input);\n        checkbox.appendChild(label);\n        checkboxWrapperEl.append(checkbox);\n    });\n    wrapper.appendChild(tocBtn);\n    wrapper.append(checkboxWrapperEl);\n    document.body.append(wrapper);\n};\nif (!window.isAuthor) {\n    fetchGetFileReviewers()\n        .then(function (_a) {\n        var fileReviewersMapping = _a[0], reviewerFilesMapping = _a[1], fileMapping = _a[2];\n        document.querySelectorAll('.differential-file-icon-header').forEach(function (headerEl) {\n            var _a, _b;\n            var filePath = (_a = headerEl.textContent) !== null && _a !== void 0 ? _a : '';\n            var chipsWrapperEl = document.createElement('div');\n            chipsWrapperEl.classList.add('Chips-wrapper');\n            (_b = fileReviewersMapping[filePath]) === null || _b === void 0 ? void 0 : _b.forEach(function (name) {\n                var chipEl = document.createElement('span');\n                chipEl.classList.add('Chip');\n                chipEl.innerHTML = name;\n                chipsWrapperEl.append(chipEl);\n            });\n            headerEl.appendChild(chipsWrapperEl);\n        });\n        addOverlay(fileReviewersMapping, reviewerFilesMapping, fileMapping);\n    })\n        .catch(console.log);\n}\n","__webpack_require__.h = () => (\"c511fd6b20ae52d3ad0a\")"],"names":[],"sourceRoot":""}